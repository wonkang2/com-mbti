<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="/css/bulletin-board/bulletin.css">
    <link rel="stylesheet" href="/css/common/header.css">
    <link rel="stylesheet" href="/css/common/page.css">
    <link rel="stylesheet" href="/css/common/layout.css">
    <title>ComMBTI</title>

    <script src="/js/common/popup.js"></script>
    <script src="https://kit.fontawesome.com/cc4e8a330a.js" crossorigin="anonymous"></script>
</head>

<body>
<header th:replace="/common/header :: header">
    게시판 헤더 부분
</header>


<section class="section">
    <header class="section__header">
        <!-- 광고 부분 -->
    </header>
    <article class="section__article">
        <div class="content__header">
            <div class="content__header__left">
                <div th:text="${bulletin.mbtiType}" class="bulletin__mbti">
                    INTJ
                </div>
                <div class="bulletin__time">
                    <i class="fa-solid fa-clock"></i>
                    <div class="bulletin__time__detail">10분전</div>
                </div>
                <div class="bulletin__view">
                    <i class="fa-solid fa-eye"></i>
                    <div th:text="${bulletin.viewCount}" class="bulletin__view__detail">5</div>
                </div>
            </div>
            <div class="content__header__right">
                <!--해당 게시글을 작성한 유저: 수정하기 삭제하기-->
                <!--TODO:해당 게시글을 작성하지 않은 유저: 신고하기-->
                <!--                <button onclick=report()>신고하기</button>-->
                <button th:onclick="location.href='/bulletin-board/bulletins/[[${bulletin.bulletinId}]]/edit';" class="content__header__right__detail">수정하기</button>
                <button th:onclick="deleteBulletin([[${bulletin.bulletinId}]])" class="content__header__right__detail">
                    삭제하기
                </button>
            </div>
        </div>

        <div class="section__article__body">
            <div th:text="${bulletin.title}" class="article__body__title">
                게시글 제목
            </div>
            <div class="article__body__content">
                <div th:if="${not #lists.isEmpty(bulletin.getFilePathList())}"
                     th:each="filePath: ${bulletin.getFilePathList()}" class="article__body__content__image">
                    <img class="body__content__image__detail" th:src="@{''} + ${filePath}"/>
                </div>
                <div th:text="${bulletin.content}" class="article__body__content__text">게시글 본문</div>
            </div>

            <div class="section__article__body__footer">
            </div>
        </div>

        <div class="section__footer">
            <!-- 댓글 부분 -->
            <form th:object="${commentRequestDto}"
                  th:action="'/bulletin-board/bulletins/' + ${bulletin.bulletinId} + '/comments/save'" th:method="post"
                  class="section__footer__form">
                <div class="section__footer__form__inp">
                    <textarea th:field="*{content}" class="footer__form__inp__detail" rows="3"
                              placeholder="댓글을 작성하려면 로그인 해주세요."></textarea>
                </div>
                <div class="section__footer__form__butn">
                    <button class="footer__form__butn__detail">댓글 쓰기</button>
                </div>
            </form>
        </div>
        <div class="section__footer__comment">
            <div class="section__footer__comment__count">
                <i class="fa-solid fa-comment"></i>
                <div th:text="${commentPage.getPageInfo().getTotal()}" class="comment__count__detail">댓글 4</div>
            </div>
            <ul class="section__footer__comment__wrapper">
                <li th:each="comment: ${commentPage.getCommentResponseDtoList()}" class="comment__wrapper__detail">
                    <div class="content__header">
                        <div th:text="${comment.mbtiType}" class="bulletin__mbti">
                            ISTP
                        </div>
                        <div class="bulletin__time">
                            <i class="fa-solid fa-clock"></i>
                            <div class="bulletin__time__detail">10분전</div>
                        </div>
                    </div>
                    <div th:text="${comment.content}" class="comment__wrapper__detail__body">季節계절이 지나가는 하늘에는
                        가을로 가득 차있습니다。
                    </div>
                </li>
            </ul>
            <nav th:if="${commentPage.pageInfo.total} > 0" class="nav__pagination">
                <ul class="pagination"
                    th:with="start=${commentPage.pageInfo.startNumber}, end=${commentPage.pageInfo.endNumber}">
                    <li class="pagination__wrapper" th:if="${start > 1}">
                        <a class="pagination__btn"
                           th:href="@{'/bulletin-board/bulletins/' + ${bulletin.bulletinId} + '/comments'(page=${start} - 10, size=10)}"
                           th:text="'<<'"></a>
                    </li>
                    <li class="pagination__wrapper" th:if="${commentPage.pageInfo.hasPreviousPage}">
                        <a class="pagination__btn"
                           th:href="@{'/bulletin-board/bulletins/' + ${bulletin.bulletinId} + '/comments'(page=${commentPage.pageInfo.currentPage} - 1, size=10)}"
                           th:text="'<'"></a>
                    </li>

                    <li class="pagination__wrapper" th:each="page: ${#numbers.sequence(start, end)}">
                        <a th:if="${page} == ${commentPage.pageInfo.currentPage}" id="pagination_button_current"
                           class="pagination__btn" th:text="${page}"
                           th:href="@{'/bulletin-board/bulletins/' + ${bulletin.bulletinId} + '/comments'(page=${page}, size=10)}"></a>
                        <a th:unless="${page} == ${commentPage.pageInfo.currentPage}" class="pagination__btn"
                           th:text="${page}"
                           th:href="@{'/bulletin-board/bulletins/' + ${bulletin.bulletinId} + '/comments'(page=${page}, size=10)}"></a>
                    </li>

                    <li class="pagination__wrapper" th:if="${commentPage.pageInfo.hasNextPage}">
                        <a class="pagination__btn"
                           th:href="@{'/bulletin-board/bulletins/' + ${bulletin.bulletinId} + '/comments'(page=${commentPage.pageInfo.currentPage} + 1, size=10)}"
                           th:text="'>'"></a>
                    </li>
                    <li class="pagination__wrapper" th:if="${end < commentPage.pageInfo.totalPage}">
                        <a class="pagination__btn"
                           th:href="@{'/bulletin-board/bulletins/' + ${bulletin.bulletinId} + '/comments'(page=${end} + 10, size=10)}"
                           th:text="'>>'"></a>
                    </li>
                </ul>
            </nav>
        </div>

    </article>
    <footer class="section__footer"></footer>
</section>
<script th:inline="javascript">
    /*<![CDATA[*/
    function deleteBulletin() {
        if (confirm("정말로 삭제하시겠습니까?")) {
            const id = [[ ${bulletin.bulletinId}]];

            const formHtml = `
          <form id="deleteForm" action="/bulletin-board/bulletins/${id}/delete" method="post">
              <input type="hidden" id="id" name="id" value="${id}" />
          </form>`;
            const doc = new DOMParser().parseFromString(formHtml, 'text/html');
            const form = doc.body.firstChild;
            document.body.append(form);
            document.getElementById('deleteForm').submit();
        }
    }

    /*]]>*/
</script>
</body>

</html>